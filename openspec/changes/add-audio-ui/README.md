# 音频转写 UI 界面变更

## 概览

为音频转写功能添加现代化的 Web UI 界面，提供拖拽上传、Markdown 预览和文件下载功能。

## 文档结构

```
openspec/changes/add-audio-ui/
├── README.md              # 本文件：变更概览
├── proposal.md            # 提案文档：需求和目标
├── design.md              # 设计文档：技术方案和架构
├── tasks.md               # 任务清单：开发计划和时间估算
└── specs/
    └── api/
        └── spec.md        # API 规范：新增端点和变更
```

## 快速开始

### 1. 阅读提案（5 分钟）

📖 [proposal.md](./proposal.md)

了解功能背景、用户场景和成功指标。

### 2. 查看技术设计（15 分钟）

🏗️ [design.md](./design.md)

- 前端技术栈：React + TypeScript + TailwindCSS
- 后端增强：新增 Markdown 输出和下载接口
- UI 设计规范：黑白灰主题配色方案

### 3. 开始开发（参考任务清单）

📋 [tasks.md](./tasks.md)

按照 7 个阶段逐步实现：

- **阶段 1**：后端 API 增强（4h）
- **阶段 2**：前端项目搭建（2h）
- **阶段 3**：核心组件开发（8h）
- **阶段 4**：样式与交互优化（4h）
- **阶段 5**：集成与测试（4h）
- **阶段 6**：部署准备（2h）
- **阶段 7**：验收与发布（2h）

**总计**：约 25 小时开发时间

### 4. 参考 API 规范（实现时查阅）

🔌 [specs/api/spec.md](./specs/api/spec.md)

增强的接口文档：

- `POST /api/v1/audio/transcribe`（新增 `output_format` 和 `output_dir` 参数）
- `GET /api/v1/audio/download/{task_id}`（文件下载）

## 核心功能

### 1. 拖拽上传界面

```
┌─────────────────────────────────────┐
│  拖拽音频文件到此处，或点击选择       │
│                                     │
│  支持 m4a, mp3, wav, flac           │
│  最大 100MB                         │
└─────────────────────────────────────┘
```

### 2. Markdown 格式纪要

```markdown
# 【会议主题】投研访谈-张三

## 主要内容
详细记录会议内容和讨论要点...

## 关键引述
重要的原话摘录...

## 关键词
`AI 产品`, `垂直应用`, `开源模型`
```

### 3. 实时进度显示

```
[████████████████░░░░] 80% - 正在生成会议纪要...
```

## 技术亮点

### 前端

- ✅ **React 18 + TypeScript**：类型安全，开发体验好
- ✅ **react-dropzone**：拖拽上传最佳实践
- ✅ **TailwindCSS**：快速定制黑白灰主题
- ✅ **zustand**：轻量级状态管理

### 后端

- ✅ **参数化设计**：通过 `output_format` 参数支持双格式
- ✅ **零冗余接口**：复用现有 `/transcribe` 端点
- ✅ **Markdown 输出**：保留 LLM 原始格式，易读易分享
- ✅ **文件管理**：支持自定义目录和文件名
- ✅ **安全增强**：路径验证、参数校验

### 部署

- ✅ **前后端分离**：开发环境独立运行
- ✅ **统一部署**：生产环境 FastAPI 托管静态文件
- ✅ **单端口访问**：简化运维

## 用户体验改进

### 改进前（命令行）

```bash
# 1. 编写脚本或 curl 命令
curl -X POST -F "file=@audio.m4a" http://localhost:8000/api/v1/audio/transcribe

# 2. 解析 JSON 输出
cat response.json | jq '.meeting_minutes.content'

# 3. 手动复制粘贴到文档
```

**问题**：
- ❌ 需要编程知识
- ❌ JSON 格式不直观
- ❌ 操作繁琐

### 改进后（Web UI）

```
1. 打开浏览器 → 拖拽音频文件
2. 等待处理（进度条显示）
3. 在线预览 Markdown 纪要
4. 一键下载 .md 文件
```

**优势**：
- ✅ 无需编程，直观易用
- ✅ Markdown 格式，可读性强
- ✅ 一站式完成所有操作

## 示例截图（待实现后补充）

### 首页（空状态）

```
┌──────────────────────────────────────────────────┐
│  音频转写与会议纪要生成                            │
└──────────────────────────────────────────────────┘
┌──────────────────┐  ┌─────────────────────────┐
│  [拖拽上传框]     │  │  上传音频后，会议纪要    │
│                  │  │  将显示在此处            │
└──────────────────┘  └─────────────────────────┘
```

### 上传中

```
┌──────────────────────────────────────────────────┐
│  正在处理: interview.m4a (4.5MB)                  │
│  [████████████░░░░] 75% - 生成会议纪要中...       │
└──────────────────────────────────────────────────┘
```

### 完成状态

```
┌──────────────────┐  ┌─────────────────────────┐
│  ✅ 处理完成      │  │  # 【会议主题】投研访谈  │
│                  │  │  ## 主要内容            │
│  [重新上传]       │  │  ...                   │
└──────────────────┘  │  [下载 Markdown]        │
                      └─────────────────────────┘
```

## 开发路线图

### 里程碑 1：后端就绪（M1）

**目标**：新增 API 接口可用

**任务**：
- [x] 增强 `/transcribe` 端点（新增 `output_format` 参数）
- [x] 实现 Markdown 文件保存
- [x] 添加文件下载接口
- [x] 编写后端测试

**验收标准**：
- cURL 可以通过 `output_format=markdown` 获取 Markdown 内容
- 返回正确的 Markdown 格式纪要
- 下载功能正常
- 向后兼容（默认 JSON 格式不变）

**预计完成**：3 小时

---

### 里程碑 2：前端 MVP（M2）

**目标**：基本 UI 功能可用

**任务**：
- [ ] 初始化 React 项目
- [ ] 实现拖拽上传组件
- [ ] 实现 Markdown 预览组件
- [ ] 连接后端 API

**验收标准**：
- 可以拖拽上传音频
- 可以查看 Markdown 纪要
- 可以下载文件

**预计完成**：13 小时（累计）

---

### 里程碑 3：完整版（M3）

**目标**：UI 美化和测试完成

**任务**：
- [ ] 应用黑白灰主题
- [ ] 添加动画和交互细节
- [ ] 响应式设计优化
- [ ] 端到端测试

**验收标准**：
- UI 美观现代
- 交互流畅自然
- 所有测试通过

**预计完成**：21 小时（累计）

---

### 里程碑 4：生产发布（M4）

**目标**：正式上线

**任务**：
- [ ] 生产构建优化
- [ ] 部署配置
- [ ] 文档更新
- [ ] 用户验收

**验收标准**：
- 生产环境稳定运行
- 文档齐全
- 用户满意度 > 80%

**预计完成**：25 小时（累计）

## 依赖关系

```
proposal.md  ──→  design.md  ──→  tasks.md  ──→  实现
    ↓                                              ↓
 需求定义                                      开发测试
                                                  ↓
                                              部署上线
```

## 风险提示

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| 前端技术栈不熟悉 | 进度延迟 | 选择团队熟悉的 React |
| Markdown 格式不统一 | 渲染异常 | 充分测试 LLM 输出 |
| 文件管理复杂度高 | 维护困难 | 使用简单的目录结构 |
| 移动端体验差 | 用户流失 | 优先保证桌面端 |

## 相关链接

- 📚 [OpenSpec 项目文档](../../project.md)
- 🔧 [音频转写变更](../add-audio-transcription/)
- 📖 [API 规范](../../specs/api/spec.md)

## 联系方式

有问题或建议？请在项目中提出 Issue 或联系开发团队。

---

**版本**：v1.0  
**创建时间**：2025-11-13  
**最后更新**：2025-11-13  
**状态**：✅ 已完成

## � 完成总结

### 实际开发情况

| 里程碑 | 状态 | 实际耗时 | 完成时间 |
|--------|------|----------|----------|
| M1: 后端就绪 | ✅ 完成 | ~3h | 2025-11-13 |
| M2: 前端 MVP | ✅ 完成 | ~9h | 2025-11-13 |
| M3: 完整版 | ✅ 完成 | ~5h | 2025-11-13 |
| M4: 生产发布 | ⏸️ 可选 | - | 按需执行 |
| **总计** | **✅ 核心完成** | **~17h** | **2025-11-13** |

### 已交付内容

**代码：**
- ✅ `api/audio_api.py` - 增强的音频 API（Markdown 输出 + 下载）
- ✅ `pipelines/audio_pipeline.py` - Markdown 生成功能
- ✅ `frontend/` - 完整 React + TypeScript UI
  - 拖拽上传组件
  - Markdown 预览组件
  - 进度条组件
  - 状态管理（zustand）
  - API 客户端（axios）

**文档：**
- ✅ `docs/audio_ui_guide.md` - 完整用户使用指南
- ✅ `frontend/README.md` - 前端开发文档
- ✅ OpenSpec 完整文档集

**工具：**
- ✅ `start_ui.bat` - 一键启动脚本
- ✅ `test_ui_integration.py` - 集成测试脚本

### 核心功能验证

| 功能 | 状态 | 备注 |
|------|------|------|
| 拖拽/点击上传 | ✅ 通过 | 支持 m4a, mp3, wav 等格式 |
| 实时进度显示 | ✅ 通过 | 上传 20% + 处理 80% |
| Markdown 预览 | ✅ 通过 | 自定义样式渲染 |
| 文件下载 | ✅ 通过 | 中文文件名正常显示 |
| 错误处理 | ✅ 通过 | 格式/大小验证 |
| 响应式设计 | ✅ 通过 | 双栏布局 |
| 浏览器兼容 | ✅ Chrome | Firefox/Safari 未测试 |

### 技术亮点

1. **零冗余 API 设计** - 单一端点通过参数控制输出格式
2. **现代化 UI** - React 18 + TypeScript + TailwindCSS 黑白灰主题
3. **完整文档** - 从提案到实现，OpenSpec 全流程记录
4. **开箱即用** - 一键启动脚本，无需复杂配置

### 使用方式

```bash
# 快速启动
start_ui.bat

# 访问应用
http://localhost:5173

# API 文档
http://localhost:8000/docs
```

### 项目截图

**界面概览：**
- 左侧：拖拽上传区 + 进度条 + 使用说明
- 右侧：Markdown 预览 + 下载按钮
- 顶部：Header 和标题
- 主题：黑白灰配色，现代化设计

**文件结构：**
```
uploads/audios/
└── {task_id}/
    ├── input.m4a
    └── {filename}_会议纪要.md
```

### 后续优化方向

**可选改进：**
- 🔄 自动化测试（Playwright）
- 📦 Docker 容器化部署
- 🔐 用户认证和权限
- 📊 历史记录管理
- 🌐 多语言支持
- ⚡ 大文件分片上传

**性能优化：**
- 文件清理策略
- 缓存机制
- CDN 静态资源

### 参考资源

- 📖 用户指南：`docs/audio_ui_guide.md`
- 🔧 开发文档：`frontend/README.md`
- 📋 任务追踪：`tasks.md`
- 🏗️ 技术设计：`design.md`

---

✨ **项目已完成核心功能开发和测试，可投入使用！**
