# 变更提案：PDF 商业计划书提取 UI 界面

## 提案概述

为 PDF 商业计划书信息提取功能开发一个现代化的 Web UI 界面，与现有音频转写 UI 保持设计风格统一，提供直观的拖拽上传体验和清晰的结构化信息展示。

## 动机

当前 PDF 提取功能仅提供 API 接口，存在以下问题：

1. **使用门槛高**：需要编写代码或使用 curl 命令，非技术人员无法使用
2. **无可视化界面**：无法直观查看提取进度和结果
3. **批量处理体验差**：缺少统一的任务管理和状态监控
4. **功能入口分散**：音频和 PDF 功能分离，缺少统一导航

## 目标

### 核心功能

1. **顶部导航菜单**
   - 音频转写 / PDF 提取 切换 Tab
   - 统一的 Header 设计，保持品牌一致性
   - 响应式设计，移动端优化

2. **现代化 PDF 上传界面**
   - 黑白灰为主色调，与音频 UI 设计风格统一
   - 支持拖拽上传 PDF 文件
   - 支持批量上传（最多 10 个文件）
   - 实时显示处理进度和状态

3. **结构化信息展示**
   - 15 个字段卡片式展示（公司信息、财务数据、业务描述等）
   - Markdown 格式支持，易读易分享
   - 支持展开/折叠长文本内容
   - 提供 JSON 和 Markdown 文件下载

4. **任务中心**
   - 展示所有 PDF 提取任务（成功/失败/处理中）
   - 支持任务状态过滤和搜索
   - 实时刷新处理中的任务
   - 支持重新处理失败任务

5. **队列状态监控**
   - 显示异步队列状态（队列长度、活跃任务、完成数）
   - 可视化队列健康度
   - 超时任务告警

### 非功能需求

1. **性能**：支持批量上传 10 个 50MB 的 PDF 文件流畅处理
2. **易用性**：与音频 UI 保持一致的交互体验
3. **美观性**：遵循现有设计系统（TailwindCSS 黑白灰主题）
4. **可维护性**：复用现有组件和状态管理模式

## 设计原则

1. **设计统一**：与音频 UI 保持相同的视觉风格和交互模式
2. **以用户为中心**：优化 PDF 上传 → 查看提取结果的核心流程
3. **批量优先**：支持批量上传和批量结果查看
4. **状态可见**：实时展示任务状态和队列健康度

## 用户场景

### 场景 1：投研人员批量提取 BP 信息

**当前流程（繁琐）**：
```bash
# 1. 编写 Python 脚本或 curl 命令
# 2. 循环上传多个 PDF 文件
# 3. 等待 API 返回 JSON
# 4. 解析 JSON 提取关键信息
# 5. 手动整理到 Excel 表格
```

**新流程（简化）**：
```
1. 打开 Web 界面，切换到 "PDF 提取" Tab
2. 拖拽多个 PDF 文件到上传区
3. 等待处理完成（进度条显示）
4. 在线查看卡片式结构化信息
5. 一键下载 Markdown/JSON 文件
```

### 场景 2：查看历史提取记录

**需求**：
- 查看过去 7 天的所有 PDF 提取任务
- 按状态筛选（成功/失败/处理中）
- 重新处理失败的任务

**解决方案**：
- 任务中心展示所有历史任务
- 支持状态过滤和时间范围筛选
- 提供"重新提取"按钮

## 技术方案概要

### 前端技术栈

- **框架**：React 18 + TypeScript（复用现有技术栈）
- **样式**：TailwindCSS（复用现有主题配置）
- **文件上传**：react-dropzone（与音频 UI 一致）
- **Markdown 渲染**：react-markdown（复用现有组件）
- **状态管理**：zustand（新增 `usePdfStore`）
- **构建工具**：Vite（现有）

### 新增组件列表

```
frontend/src/
├── App.tsx                          # 修改：增加顶部 Tab 切换
├── components/
│   ├── TabNavigation.tsx            # 新增：顶部导航 Tab
│   ├── pdf/
│   │   ├── PdfUploader.tsx          # 新增：PDF 拖拽上传组件
│   │   ├── PdfExtractionResult.tsx  # 新增：15 字段卡片展示
│   │   ├── PdfTaskPanel.tsx         # 新增：PDF 任务列表
│   │   ├── PdfQueueStatus.tsx       # 新增：队列状态组件
│   │   └── PdfTaskDetailDrawer.tsx  # 新增：任务详情抽屉
├── store/
│   └── usePdfStore.ts               # 新增：PDF 状态管理
├── services/
│   └── pdfApi.ts                    # 新增：PDF API 客户端
└── types/
    └── pdf.ts                       # 新增：PDF TypeScript 类型
```

### 后端增强

后端 API 已完全实现，无需额外开发：
- ✅ `POST /api/v1/pdf/extract` - 单个 PDF 提交
- ✅ `POST /api/v1/pdf/extract/batch` - 批量提交
- ✅ `GET /api/v1/pdf/extract/{task_id}` - 查询任务状态
- ✅ `GET /api/v1/pdf/extract` - 列表查询（支持分页和过滤）
- ✅ `GET /api/v1/pdf/queue/status` - 队列状态
- ✅ `GET /api/v1/pdf/download/{task_id}/{file_type}` - 下载结果
- ✅ `GET /api/v1/pdf/health` - 健康检查

## 成功指标

1. **易用性**：新用户 3 分钟内完成首次 PDF 提取
2. **输出质量**：15 个字段卡片展示清晰，无需二次整理
3. **性能**：批量上传 10 个文件响应时间 < 500ms
4. **用户反馈**：首批用户满意度 > 80%
5. **设计一致性**：与音频 UI 视觉风格匹配度 > 95%

## 风险与缓解

| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| Tab 切换导致状态丢失 | 用户体验下降 | 使用独立的状态管理（usePdfStore 和 useAudioStore） |
| 批量上传性能问题 | 页面卡顿 | 限制最多 10 个文件，使用虚拟滚动 |
| 15 个字段展示混乱 | 可读性差 | 使用卡片式布局 + 折叠面板 |
| 队列状态轮询频繁 | 后端压力大 | 仅对处理中的任务轮询，完成后停止 |

## 下一步

1. ✅ 创建 OpenSpec 提案
2. ⏸️ 评审技术设计方案
3. ⏸️ 开发前端 UI 组件
4. ⏸️ 集成后端 API
5. ⏸️ 集成测试和用户验收

## 相关资源

- 现有 API 文档：`openspec/specs/api/spec.md`
- PDF 提取变更：`openspec/changes/add-pdf-extraction/`
- 音频 UI 参考：`openspec/changes/add-audio-ui/`
- 设计系统：TailwindCSS 黑白灰主题配置
