# 提案：添加音频转写和会议纪要生成接口

## 变更概述
为 API 系统添加音频上传、ASR 转写和 LLM 会议纪要生成功能，支持投研尽调、专家访谈、客户访谈等场景的音频处理。

## 问题陈述
当前系统仅支持文档（JSON）的知识图谱提取，无法处理音频文件。业务需要将录音转换为结构化的会议纪要，以便：
- 快速回顾访谈要点
- 保留关键原话，避免信息失真
- 提取关键词用于分类和检索
- 投研团队需要高质量、易读的访谈记录

## 提议的变更

### 1. 音频处理 Pipeline
创建新的 `AudioPipeline` 模块，负责：
- 接收音频文件（m4a, mp3, wav 等格式）
- 调用阿里云 DashScope ASR API（qwen3-asr-flash 模型）进行语音转文字
- 将转写文本传递给 LLM 进行纪要整理

### 2. 会议纪要生成
使用 qwen-plus-latest 模型生成高质量会议纪要，包括：
- **完整转写文本**：ASR 原始输出，保留所有细节
- **结构化纪要**：梳理重点内容，保留关键原话
- **关键词提取**：使用 `<KEYWORD></KEYWORD>` 标签标注

### 3. API 端点扩展
在现有 FastAPI 服务中添加：
- `POST /api/v1/audio/transcribe` - 音频转写和纪要生成接口
- 支持同步/异步处理模式（基于文件大小）
- 返回双版本输出：转写文本 + 会议纪要

### 4. 质量保证
- **准确性优先**：纪要必须忠实原文，严禁曲解和过度解读
- **可读性优化**：条理清晰，便于快速理解
- **关键词凝练**：3-8 个高度概括的标签

## 受影响的组件
- **新增**：`pipelines/audio_pipeline.py` - 音频处理模块
- **新增**：`pipelines/audio_models.py` - 数据模型定义
- **新增**：`pipelines/prompts/audio_transcription.txt` - ASR 系统提示词
- **新增**：`pipelines/prompts/meeting_minutes.txt` - 纪要生成提示词
- **修改**：`api.py` - 添加新的 API 端点
- **修改**：`api_models.py` - 添加音频相关的请求/响应模型

## 技术依赖
- 阿里云 DashScope ASR API（qwen3-asr-flash）
- 阿里云 DashScope LLM API（qwen-plus-latest）
- 现有的 FastAPI 基础设施
- 支持的音频格式：m4a, mp3, wav, flac, opus

## 非功能性需求
- **处理时长限制**：单个音频文件最长 120 分钟
- **文件大小限制**：最大 100MB
- **异步处理阈值**：音频时长 > 10 分钟时自动异步处理
- **响应时间**：短音频（<5分钟）应在 60 秒内返回结果

## 预期收益
- 支持多模态输入，扩展系统能力
- 为投研团队提供自动化访谈记录工具
- 提高信息提取效率，减少人工转写成本
- 确保访谈记录的准确性和一致性

## 风险与缓解
| 风险 | 影响 | 缓解措施 |
|------|------|----------|
| ASR 识别准确率不足 | 转写错误导致纪要质量下降 | 启用 ITN（文本规范化），支持用户手动校正 |
| 长音频处理超时 | 用户体验差 | 实施异步任务队列，提供进度查询 |
| LLM 生成内容失真 | 纪要不准确 | Prompt 工程强调"忠实原文"，禁止推测 |
| 并发处理资源消耗 | 服务不稳定 | 限流 + 任务队列，设置最大并发数 |

## 实施计划
见 `tasks.md`

## 成功标准
1. ✅ 能够上传音频文件并成功转写
2. ✅ 生成的会议纪要忠实原文，无曲解
3. ✅ 关键词准确反映内容主题
4. ✅ API 响应时间符合预期
5. ✅ 完整的单元测试和集成测试覆盖

## 相关文档
- 阿里云 DashScope ASR API 文档
- 现有 API 规范：`openspec/specs/api/spec.md`
- 现有 Pipeline 实现参考：`pipelines/text_pipeline.py`
