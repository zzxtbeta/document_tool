# 音频转写 UI 使用指南

## 🚀 快速开始

### 启动服务

使用提供的启动脚本一键启动前后端服务：

```bash
start_ui.bat
```

或者手动启动：

**1. 启动后端 API（终端 1）**
```bash
python -m uvicorn api:app --reload --port 8000
```

**2. 启动前端界面（终端 2）**
```bash
cd frontend
npm run dev
```

**3. 访问应用**
- 前端界面：http://localhost:5173
- API 文档：http://localhost:8000/docs

---

## 📱 界面使用

### 1. 上传音频文件

**方式一：拖拽上传**
- 将音频文件拖拽到左侧的上传区域
- 支持格式：m4a, mp3, wav, flac, opus, aac
- 文件大小限制：100MB

**方式二：点击选择**
- 点击上传区域
- 在文件选择器中选择音频文件

### 2. 处理过程

上传后系统会自动：
1. **上传阶段**（20% 进度）
   - 文件上传到服务器
   
2. **处理阶段**（20%-100% 进度）
   - 语音转文字（ASR）
   - LLM 生成会议纪要
   - 格式化 Markdown 文档

3. **完成阶段**
   - 右侧显示 Markdown 预览
   - 可以下载完整文件

### 3. 预览与下载

**预览区域显示：**
- 📝 会议标题
- 📄 内容总结
- 💬 关键引述
- 🏷️ 关键词标签
- ⏱️ 处理统计（转写时间、生成时间）

**下载功能：**
- 点击右上角"下载 Markdown"按钮
- 文件名格式：`原文件名_会议纪要.md`

---

## 🎨 界面说明

### 顶部 Header
- 🎙️ Logo 和标题
- 功能说明

### 左侧栏（上传区）

**上传区域**
- 云图标上传框
- 拖拽高亮效果
- 支持格式提示

**进度条**（处理中显示）
- 百分比进度
- 状态文字（上传中/处理中/完成）
- 错误提示（如有）

**使用说明卡片**
- 支持格式列表
- 文件大小限制
- 预估处理时间
- 生成内容说明

### 右侧栏（预览区）

**空状态**
- 📄 文档图标
- 提示文字

**加载状态**
- 🔄 旋转加载动画

**预览内容**
- 操作栏（统计信息 + 下载按钮）
- Markdown 格式内容
- 自定义样式（标题、引用、代码等）
- 任务 ID 信息

---

## 🔧 技术说明

### 处理流程

1. **文件验证**
   - 格式检查（仅允许音频格式）
   - 大小检查（≤100MB）
   - 安全检查（路径遍历防护）

2. **语音转文字（ASR）**
   - 模型：DashScope `qwen3-asr-flash`
   - 开启 ITN（逆文本规范化）
   - 支持中英文混合

3. **LLM 生成纪要**
   - 模型：DashScope `qwen-plus-latest`
   - 结构化输出（标题、内容、引用、关键词）
   - 自动提取关键信息

4. **Markdown 生成**
   - 格式化文档结构
   - 添加元数据（生成时间、任务 ID）
   - UTF-8 编码保存

### 文件存储结构

```
uploads/audios/
└── {task_id}/              # UUID 任务目录
    ├── input.m4a          # 原始音频文件
    └── {filename}_minutes.md  # 生成的 Markdown 纪要
```

### API 端点

**转写端点**
```
POST /api/v1/audio/transcribe
Content-Type: multipart/form-data

参数：
- file: 音频文件（必需）
- output_format: 输出格式（可选，默认 "markdown"）
- output_dir: 自定义输出目录（可选）
- enable_itn: 启用 ITN（可选，默认 true）
```

**下载端点**
```
GET /api/v1/audio/download/{task_id}

返回：Markdown 文件（Content-Type: text/markdown）
```

---

## ⚙️ 配置说明

### 环境变量（可选）

在项目根目录创建 `.env` 文件：

```bash
# 音频配置
AUDIO_MAX_FILE_SIZE=100        # 最大文件大小（MB）
AUDIO_ASYNC_THRESHOLD=600      # 异步处理阈值（秒）

# DashScope API
DASHSCOPE_API_KEY=your_api_key  # 必需
```

### 前端配置

修改 `frontend/vite.config.ts` 中的代理设置（如果后端不在 localhost:8000）：

```typescript
server: {
  proxy: {
    '/api': {
      target: 'http://your-backend-url:8000',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, ''),
    },
  },
}
```

---

## 🐛 常见问题

### 1. 上传失败

**问题：** "上传失败，请重试"

**解决方案：**
- 检查文件格式是否支持
- 确认文件大小 ≤100MB
- 检查后端服务是否运行
- 查看浏览器控制台错误信息

### 2. 处理超时

**问题：** 长时间卡在"处理中"

**解决方案：**
- 大文件（>50MB）可能需要 1-3 分钟
- 检查网络连接
- 查看后端日志是否有错误
- 刷新页面重试

### 3. 下载不工作

**问题：** 点击下载按钮无反应

**解决方案：**
- 确认处理已完成（进度 100%）
- 检查浏览器下载权限
- 查看浏览器控制台错误
- 尝试不同浏览器

### 4. 前端空白页面

**问题：** 访问 localhost:5173 显示空白

**解决方案：**
```bash
cd frontend
npm install          # 重新安装依赖
npm run dev          # 重启开发服务器
```

### 5. 代理错误 (ERR_CONNECTION_REFUSED)

**问题：** 前端请求后端 API 失败

**解决方案：**
- 确认后端运行在 localhost:8000
- 检查 `vite.config.ts` 代理配置
- 查看后端终端是否有启动日志

---

## 📊 性能参考

### 处理时间估算

| 音频长度 | 文件大小 | ASR 时间 | LLM 时间 | 总耗时 |
|---------|---------|---------|---------|--------|
| 10 秒    | ~1MB    | 1-2s    | 3-5s    | 5-8s   |
| 1 分钟   | ~5MB    | 2-4s    | 4-6s    | 8-12s  |
| 5 分钟   | ~25MB   | 5-10s   | 5-8s    | 12-20s |
| 30 分钟  | ~150MB  | 超限    | -       | -      |

**注意：** 100MB 文件限制约等于 20 分钟音频

### 浏览器兼容性

- ✅ Chrome 90+
- ✅ Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+

---

## 🎯 使用场景

### 适用场景

1. **会议录音转写**
   - 团队会议记录
   - 客户沟通记录
   - 项目讨论总结

2. **访谈内容整理**
   - 用户访谈记录
   - 专家采访整理
   - 调研录音转文字

3. **课程讲座笔记**
   - 在线课程录音
   - 讲座内容记录
   - 培训材料整理

4. **语音备忘录**
   - 个人语音笔记
   - 想法快速记录
   - 待办事项整理

### 输出内容

生成的 Markdown 包含：

```markdown
# 会议标题
[自动提取的主题]

## 主要内容
[关键讨论点总结]

## 关键引述
> "重要发言原文"

## 关键词
标签1, 标签2, 标签3

## 完整转写
[完整的语音转文字内容]

---
生成时间：2025-11-13 18:15:00
任务 ID: {uuid}
```

---

## 🔒 安全说明

### 数据安全

- ✅ 文件存储在本地 `uploads/audios/` 目录
- ✅ 路径遍历攻击防护（禁止 `../` 等）
- ✅ 文件类型白名单验证
- ✅ 文件大小限制
- ⚠️ 未实现用户认证（适用于内部网络）

### API 密钥

- 🔑 DashScope API 密钥存储在 `.env` 文件
- ❌ 不要提交 `.env` 到 Git
- ✅ 示例配置见 `.env.example`

### 生产部署建议

1. 启用 HTTPS
2. 添加用户认证
3. 实现文件清理策略
4. 配置 CORS 白名单
5. 限流和请求频率控制

---

## 📝 开发说明

### 修改 UI 样式

主题配置在 `frontend/tailwind.config.js`：

```javascript
colors: {
  primary: colors.gray,  // 主色调（灰色系）
  accent: {
    blue: '#3b82f6',    // 强调色（蓝色）
    green: '#10b981',   // 成功色（绿色）
    red: '#ef4444',     // 错误色（红色）
  },
}
```

### 添加新功能

1. **后端**：修改 `api/audio_api.py`
2. **前端组件**：在 `frontend/src/components/` 添加
3. **状态管理**：修改 `frontend/src/store/useAudioStore.ts`
4. **类型定义**：更新 `frontend/src/types/audio.ts`

### 调试建议

**后端日志：**
```bash
# 查看详细日志
uvicorn api:app --reload --log-level debug
```

**前端调试：**
- 打开浏览器开发者工具（F12）
- 查看 Network 标签（API 请求）
- 查看 Console 标签（错误信息）

---

## 🎉 总结

这是一个**现代化、易用的音频转写和会议纪要生成工具**，具有：

- ✨ 拖拽上传，操作简单
- ⚡ 自动处理，无需等待
- 📝 Markdown 输出，格式规范
- 🎨 现代化 UI，体验流畅
- 🔧 开源可扩展，二次开发友好

**开始使用吧！** 🚀
